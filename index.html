<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>MJPEG Screen Mirroring</title>
    <style>
        body { margin: 0; background-color: black; }
        img { width: 100vw; height: 100vh; object-fit: contain; }
    </style>
</head>
<body>
    <img id="stream-image" />

    <script src="//www.gstatic.com/cast/sdk/libs/caf_receiver/latest/cast_receiver_framework.js"></script>
    <script>
        window.__onGCastApiAvailable = function(isAvailable) {
            if (isAvailable) initializeApp();
        };

        function initializeApp() {
            const streamImage = document.getElementById('stream-image');
            const NAMESPACE = 'urn:x-cast:com.xxx.screenmirroring';
            
            const context = cast.framework.CastReceiverContext.getInstance();
            const castReceiverOptions = new cast.framework.CastReceiverOptions();
            castReceiverOptions.disableIdleTimeout = true;

            context.addCustomMessageListener(NAMESPACE, (customEvent) => {
                try {
                    const message = JSON.parse(customEvent.data);
                    if (message.type === 'frame' && message.data) {
                        // This is the entire logic. Update the image source.
                        streamImage.src = `data:image/jpeg;base64,${message.data}`;
                    }
                } catch (e) { /* Ignore parsing errors */ }
            });
            
            context.addEventListener(cast.framework.system.EventType.SENDER_DISCONNECTED, () => {
                window.location.reload();
            });

            context.start(castReceiverOptions);
        }
    </script>
</body>
</html>
